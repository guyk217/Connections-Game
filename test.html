<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>בדיקת Proxy ל‑GitHub API</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { font-family: sans-serif; padding: 20px; direction: rtl; background: #f9f9f9; }
    button, input { font-size: 18px; padding: 8px; width: 100%; margin: 10px 0; }
    textarea { width: 100%; height: 200px; font-family: monospace; margin-top: 20px; direction: ltr; }
  </style>
</head>
<body>
<h2>🚀 בדיקת Proxy ל־levels.json</h2>

<label>הכנס טוקן GitHub:</label>
<input type="password" id="token" placeholder="github_pat_...">

<button onclick="runTest()">הפעל בדיקה</button>

<textarea id="output" readonly placeholder="תוצאת הבדיקה תופיע כאן..."></textarea>

<script>
const proxyURL = "https://connections-guyk-worker.guyk.workers.dev/levels.json";

async function runTest() {
  const out = document.getElementById("output");
  out.value = "📥 מתחיל קריאה ל־GET דרך Proxy...\n";
  const token = document.getElementById("token").value.trim();

  try {
    const res = await fetch(proxyURL + "?token=" + encodeURIComponent(token));
    const text = await res.text();
    out.value += `GET status: ${res.status}\n`;
    out.value += `GET body (חלקי):\n${text.slice(0, 200)}...\n`;

    out.value += "\n💾 עכשיו מבצע PUT של תוכן לא משתנה...\n";
    const json = JSON.parse(text);
    const resPut = await fetch(proxyURL + "?token=" + encodeURIComponent(token), {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ content: btoa(unescape(encodeURIComponent(JSON.stringify(json)))), sha: json.sha })
    });
    const putText = await resPut.text();
    out.value += `PUT status: ${resPut.status}\n`;
    out.value += `PUT תגובת שרת:\n${putText}\n`;

  } catch (e) {
    out.value += `💥 שגיאה: ${e.message}`;
  }
}
</script>
</body>
</html>