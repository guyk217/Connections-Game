<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
  <meta charset="UTF-8" />
  <title>×‘×“×™×§×ª ×›×ª×™×‘×” ×œÖ¾GitHub</title>
  <style>
    body { font-family: sans-serif; background: #fffbe7; text-align: center; padding: 30px; }
    button, input { font-size: 18px; padding: 10px; margin: 10px; }
    pre { text-align: left; direction: ltr; background: #eee; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h2>ğŸ” ×‘×“×™×§×ª ×›×ª×™×‘×” ×œ×§×•×‘×¥ levels.json</h2>

  <input type="password" id="tokenInput" placeholder="×”×›× ×¡ ××ª ×”×˜×•×§×Ÿ ×©×œ×š (ghp_...)" size="40">
  <br>
  <button onclick="startTest()">×”×¤×¢×œ ×‘×“×™×§×”</button>
  <pre id="log">××•×›×Ÿ ×œ×‘×“×™×§×”.</pre>

  <script>
    const repo = "guyk217/Connections-Game";
    const path = "levels.json";
    const api = `https://api.github.com/repos/${repo}/contents/${path}`;

    function log(msg) {
      document.getElementById("log").textContent = msg;
    }

    async function startTest() {
      const token = document.getElementById("tokenInput").value.trim();
      if (!token.startsWith("ghp_")) {
        return log("âŒ ×˜×•×§×Ÿ ×œ× ×ª×§×™×Ÿ. ×•×“× ×©×”×•× ××ª×—×™×œ ×‘Ö¾ghp_");
      }

      const headers = {
        Authorization: `Bearer ${token}`,
        Accept: "application/vnd.github.v3+json"
      };

      log("ğŸ”„ ×˜×•×¢×Ÿ ××ª ×”×§×•×‘×¥...");
      const res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, { headers });
      if (!res.ok) {
        const err = await res.json();
        return log("âŒ ×©×’×™××” ×‘×˜×¢×™× ×”:\n" + JSON.stringify(err, null, 2));
      }

      const data = await res.json();
      const sha = data.sha;
      const originalText = atob(data.content.replace(/\n/g, ""));
      navigator.clipboard.writeText(originalText);
      log("ğŸ“‹ ×”×ª×•×›×Ÿ ×”××§×•×¨×™ ×”×•×¢×ª×§ ×œÖ¾Clipboard.");

      let json;
      try {
        json = JSON.parse(originalText);
        if (!Array.isArray(json)) throw "×§×•×‘×¥ JSON ××™× ×• ××¢×¨×š.";
      } catch (e) {
        return log("âŒ ×©×’×™××ª JSON: " + e);
      }

      // ×©×œ×‘ ×œ×‘×“×™×§×”
      const testLevel = {
        title: "×©×œ×‘ ×‘×“×™×§×”",
        words: [
          "×‘×“×™×§×”1", "×‘×“×™×§×”2", "×‘×“×™×§×”3", "×‘×“×™×§×”4",
          "×‘×“×™×§×”5", "×‘×“×™×§×”6", "×‘×“×™×§×”7", "×‘×“×™×§×”8",
          "×‘×“×™×§×”9", "×‘×“×™×§×”10", "×‘×“×™×§×”11", "×‘×“×™×§×”12",
          "×‘×“×™×§×”13", "×‘×“×™×§×”14", "×‘×“×™×§×”15", "×‘×“×™×§×”16"
        ],
        groups: {
          "×§×‘×•×¦×” ×": ["×‘×“×™×§×”1", "×‘×“×™×§×”2", "×‘×“×™×§×”3", "×‘×“×™×§×”4"],
          "×§×‘×•×¦×” ×‘": ["×‘×“×™×§×”5", "×‘×“×™×§×”6", "×‘×“×™×§×”7", "×‘×“×™×§×”8"],
          "×§×‘×•×¦×” ×’": ["×‘×“×™×§×”9", "×‘×“×™×§×”10", "×‘×“×™×§×”11", "×‘×“×™×§×”12"],
          "×§×‘×•×¦×” ×“": ["×‘×“×™×§×”13", "×‘×“×™×§×”14", "×‘×“×™×§×”15", "×‘×“×™×§×”16"]
        },
        hintPair: ["×‘×“×™×§×”1", "×‘×“×™×§×”2"]
      };

      json.push(testLevel);
      const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(json, null, 2))));

      log("ğŸ“ ×©×•×œ×— ×œ×§×•×‘×¥...");
      const updateRes = await fetch(api, {
        method: "PUT",
        headers,
        body: JSON.stringify({
          message: "×‘×“×™×§×ª ×›×ª×™×‘×” ×œÖ¾levels.json",
          content: newContent,
          sha
        })
      });

      if (updateRes.ok) {
        log("âœ… ×”×¦×œ×—×” â€“ ×”×§×•×‘×¥ ×¢×•×“×›×Ÿ!");
      } else {
        const err = await updateRes.json();
        log("âŒ ×©×’×™××” ×‘×©××™×¨×”:\n" + JSON.stringify(err, null, 2));
      }
    }
  </script>
</body>
</html>