<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>×‘×“×™×§×ª ×›×ª×™×‘×” ×œ-GitHub</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #fff8dc; direction: rtl; }
    input, button { font-size: 16px; padding: 10px; width: 100%; margin-bottom: 10px; }
    pre { background: #eee; padding: 10px; overflow-x: auto; max-height: 300px; }
  </style>
</head>
<body>

<h1>×‘×“×™×§×ª ×©××™×¨×” ×œ-GitHub</h1>
<input type="password" id="token" placeholder="×”×›× ×¡ ×˜×•×§×Ÿ GitHub (ghp_...)">
<button onclick="start()">×‘×“×•×§ ×›×ª×™×‘×”</button>
<pre id="log"></pre>

<script>
async function start() {
  const log = msg => document.getElementById('log').textContent += msg + '\n';
  const token = document.getElementById('token').value.trim();
  if (!token) return alert("×”×›× ×¡ ×˜×•×§×Ÿ");

  const apiUrl = "https://api.github.com/repos/guyk217/Connections-Game/contents/levels.json";
  log("ğŸ”„ ×˜×•×¢×Ÿ ×§×•×‘×¥...");

  const getRes = await fetch(apiUrl, {
    headers: { Authorization: `token ${token}` }
  });

  if (!getRes.ok) return log("âŒ ×©×’×™××” ×‘×§×¨×™××”: " + getRes.status);

  const fileData = await getRes.json();
  const sha = fileData.sha;

  const decoded = decodeURIComponent(escape(atob(fileData.content)));
  const levels = JSON.parse(decoded);

  log("âœ… × ×˜×¢×Ÿ. ××¢×ª×™×§ ×’×™×‘×•×™ ×œ×§×œ×™×¤×‘×•×¨×“...");
  await navigator.clipboard.writeText(JSON.stringify(levels, null, 2));
  log("ğŸ“‹ × ×©××¨ ×œ×§×œ×™×¤×‘×•×¨×“.");

  // ×”×•×¡×¤×ª ×©×œ×‘ ×‘×“×™×§×”
  levels.push({
    title: "×‘×“×™×§×ª ×©××™×¨×”",
    difficulty: "×§×œ",
    words: ["×", "×‘", "×’", "×“", "1", "2", "3", "4", "!", "@", "#", "$", "one", "two", "three", "four"],
    groups: {
      "××•×ª×™×•×ª": ["×", "×‘", "×’", "×“"],
      "××¡×¤×¨×™×": ["1", "2", "3", "4"],
      "×¡××œ×™×": ["!", "@", "#", "$"],
      "××™×œ×™×": ["one", "two", "three", "four"]
    },
    hintPair: ["×", "×‘"]
  });

  const encoded = btoa(encodeURIComponent(JSON.stringify(levels, null, 2)).replace(/%([0-9A-F]{2})/g, (_, p1) =>
    String.fromCharCode('0x' + p1)
  ));

  log("ğŸ“ ×©×•××¨ ×§×•×‘×¥...");
  const putRes = await fetch(apiUrl, {
    method: "PUT",
    headers: {
      Authorization: `token ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: "×‘×“×™×§×ª ×›×ª×™×‘×” ×“×¨×š test.html",
      content: encoded,
      sha: sha
    })
  });

  if (putRes.ok) {
    log("âœ… × ×©××¨ ×‘×”×¦×œ×—×”!");
  } else {
    const error = await putRes.text();
    log("âŒ ×©×’×™××” ×‘×©××™×¨×”: " + error);
  }
}
</script>

</body>
</html>